# 什么是字符集

- 字符集是一套符号和编码的规则，字符串都必须有相应的字符集
- 校验集是这套符号和编码的校验规则，定义字符的排序规则，字符中串之间比较的规则
- ASCII字符在不同字符集中，其所需的字节数是不一样的
- 非ASCII字符在不同字符集中，其所需的字节数也是不一样的
- **多字节字符间是以字符进行比较，而非字节为单位进行比较**
- 个别校验集是二进制的，基于字符对应的数字进行比较

# 不同字符集编码

- GBK：2个字节
- UTF8:3个字节
- ASCII：1个字节(7bit)
- latin：1字节
- **字节编码转换全部通过Unicode转换**

## 字符集必会的实例

- VARCHAR(30)在UTF-8字符集下，最多可以写入几个英文
	- 30个英文字符
- VARCHAR(30)在UTF-8字符集下，最大长度？最多可以写入几个中文字符
	- 91个字节，30个中文字符
- VARCHAR(30)在UTF-8字符集下，最大长度？存储了？个汉字，字节数应该是？
	- 91个字节，30个中文字符
- VARCHAR(30)在UTF-8字符集下，存储了30个英文，字节数应该是？
	- 91个字节
- VARCHAR(30)在GBK字符集，存储了30个汉字，字节数应该是？
	- 61个字节
- VARCHAR(30)在GBK字符集，存储了30个英文，字节数应该是？
	- 61个字节
- VARCHAR(30)LATIN1字符集，存储了15个汉字，字节数应该是？
	- 31个字节
- VARCHAR(30)LATIN1字符集，存储了30个英文，字节数应该是？
	- 31个字节
varchar < 225字节的时候，有1个额外的字节来计算当前存储长度


# 字符集多层面

- 服务器层                     
- 数据库层
- 数据表
- 字段
- 连接
- 结果集

- 服务端：server ==> database ==> table ==> column
- 客户端：connection ==> result
- 动态修改客户端字符集：set names utf8/gbk/latin1
- 无法动态修改服务器字符集

# 实操数据库转码

- 线下操作
```
mysqldump --single-transaction --master-data=2 -A --where='1=1 limit 10000' > file1.sql
iconv -t utf8 file.sql > file2.sql
转码有错误的时候可以使用'-c'参数iconv -c -t utf8 file.sql > file2.sql
最后file2导入数据库
```

- 线上迁移  
全量备份转码utf8  
借助DTS服务做增量传输 


# 了解engine

数据库引擎比较多，我们重点学习MySQL InnoDB引擎 

### MySQL官方自带的引擎

- MEMORY            
- CSV               
- MRG_MYISAM        
- BLACKHOLE         
- InnoDB            
- PERFORMANCE_SCHEMA
- ARCHIVE           
- MyISAM            
- FEDERATED         

### 了解业界其它引擎

- tokudb
- MyRocks
- Spider
- Sequence
- SphinxSE

# InnoDB和MyISAM区别

面试中经常会问起到两者之前的区别  

- 事物支持方面：InnoDB支持
- 对锁的级别：InnoDB支持行级别，MyISAM支持table级别
- 多版本并发控制：InnoDB支持
- 聚集索引：InnoDB支持
- 缓存方面：InnoDB支持缓存数据和索引(缓存到buffer pool)，MyISAM缓存索引
